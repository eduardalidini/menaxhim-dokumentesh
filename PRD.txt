1. Përmbledhje Ekzekutive
Qëllimi:
Të zhvillohet një shërbim web (RESTful) që mbështet procesin administrativ/akademik të menaxhimit të dokumenteve të sekretarisë mësimore në një departament universitar. Skedarët ruhen në Google Drive, ndërsa në bazën e të dhënave ruhen vetëm metadata dhe lidhja (linku/ID) e dokumentit.

Tema e projektit:
Menaxhimi i dokumenteve të sekretarisë mësimore (kërkesa, vendime, formularë, njoftime, etj.).

Teknologjia e shërbimit:
RESTful Web Service mbi HTTP (vetëm REST) (JSON + Multipart/Form-Data).

Objektivat kryesore
1) Digjitalizimi dhe arkivimi i dokumenteve në Cloud (Google Drive).
2) Ndarja e ruajtjes: Skedari në Drive, metadata/indeksimi në DB.
3) Ekspozimi i funksioneve kryesore përmes API për një klient tjetër (p.sh. React SPA) për demonstrim.
4) Siguri bazë dhe kontroll i aksesit (role-based) për përdorim akademik.

Nënseksion: Funksione/Features të kësaj pjese
- Funksione: menaxhim dokumentesh (ngarkim, listim/kërkim, përditësim, fshirje/arkivim), shikim/shkarkim përmes linkut.

________________________________________
6. Kërkesat funksionale (Functional Requirements)

6.1. Menaxhimi i dokumenteve (CRUD + Arkivim)
Nënseksion: Features/Funksione
- FR-1 Ngarkim dokumenti (Upload): ngarkon skedar dhe krijon rekord metadata.
- FR-2 Listim dokumentesh: shfaq listë me filtra bazikë.
- FR-3 Kërkim dokumentesh: kërkim sipas titullit/kodit/kategorisë/intervalit të datës.
- FR-4 Shikim detaje: shfaq metadata + linkun e Drive.
- FR-5 Përditësim metadata: ndryshon titull/kategori/përshkrim/tags.
- FR-6 Përditësim skedari (Replace file): zëvendëson file-in në Google Drive për një dokument ekzistues dhe përditëson metadata (file_type, updated_at, web_view_link nëse ndryshon).
- FR-7 Fshirje ose arkivim:
  - Arkivim (soft delete): e bën dokumentin “archived” por e ruan në Drive.
  - Fshirje (hard delete): e fshin nga Drive dhe nga DB (me kontrolle sigurie).

Nënseksion: Input/Output (në nivel kërkese)
- Input: skedar (pdf/docx), metadata (title, category, description, tags).
- Output: JSON me id, drive_file_id, web_view_link, created_at, status.

Nënseksion: Rregulla biznesi
- Titulli është i detyrueshëm.
- Tipet e lejuara: application/pdf, application/vnd.openxmlformats-officedocument.wordprocessingml.document (ose të konfiguruara).
- Nuk lejohet “hard delete” pa rol admin.
- Zëvendësimi i skedarit (FR-6) lejohet vetëm për rolet Sekretaria dhe Admin.
- Gjatë replace file, sistemi nuk duhet të lërë skedarë “jetimë” në Drive (ose fshin versionin e vjetër, ose e zhvendos në një folder “Archived/Old Versions” sipas konfigurimit).
- Nëse dështoi upload në Drive, nuk krijohet rekord në DB.

Nënseksion: Kriter pranimi (Acceptance)
- Pas upload: dokumenti shfaqet në listë dhe linku hapet në browser.
- Search kthen rezultate të sakta sipas query.
- Arkivimi e heq nga listat aktive (default) por mbetet i aksesueshëm në “Archived”.
- Pas replace file: linku hap versionin e ri, updated_at ndryshon dhe file_type reflekton skedarin e ri.

6.2. Autentikimi dhe autorizimi (i detyrueshëm)
Nënseksion: Features/Funksione
- FR-8 Login (token-based) me akses përmes HTTP (p.sh. Bearer JWT).
- FR-9 Role-based access control (RBAC) për çdo endpoint:
  - Sekretaria: upload, update metadata, replace file, archive.
  - Staf akademik: list/search/view.
  - Admin: të gjitha (përfshirë hard delete dhe menaxhim role/përdoruesish).
- FR-10 Logout/Invalidim sesioni (minimum: skadim token).

Nënseksion: Input/Output
- Input: kredenciale (email/username + password) për login.
- Output: access_token + roli i përdoruesit (në token ose në përgjigje).

Nënseksion: Kriter pranimi
- Të gjitha endpoint-et (përveç login) kërkojnë autentikim.
- Endpoint-et refuzojnë kërkesa pa token (401) dhe pa rol (403).
- Roli Sekretaria nuk mund të bëjë hard delete.

6.3. (Opsionale) Përmbledhje automatike me AI
Nënseksion: Features/Funksione
- FR-11 Gjenerim përmbledhje gjatë upload-it për dokumente PDF tekstuale.

Nënseksion: Rregulla
- Nëse AI dështon: dokumenti ruhet normalisht, fusha ai_summary mbetet NULL ose “Summary not available”.

________________________________________
7. Rrjedha kryesore e proceseve (System Flows)

7.1. Rrjedha A: Upload dokumenti
Nënseksion: Hapat
1) Client dërgon POST /api/documents (multipart) me file + title + metadata.
2) Backend validon tipin dhe madhësinë.
3) Backend ngarkon file në Google Drive dhe merr drive_file_id + web_view_link.
4) Backend ruan metadata në DB.
5) Backend kthen 201 me objektin e dokumentit.

7.2. Rrjedha B: Listim/Kërkim
Nënseksion: Hapat
1) Client dërgon GET /api/documents?query=...&category=...&status=active.
2) Backend query në DB dhe kthen rezultate.

7.3. Rrjedha C: Arkivim/Fshirje
Nënseksion: Hapat
- Arkivim: PATCH /api/documents/{id}/archive -> status=archived.
- Hard delete: DELETE /api/documents/{id} -> fshin në Drive, pastaj në DB.

7.4. Rrjedha D: Replace file (zëvendësim skedari)
Nënseksion: Hapat
1) Client dërgon PUT /api/documents/{id}/file (multipart) me file.
2) Backend verifikon rolin (Sekretaria/Admin) dhe validon tipin/madhësinë.
3) Backend zëvendëson skedarin në Drive (sipas strategjisë së zgjedhur) dhe merr linkun e ri nëse ndryshon.
4) Backend përditëson DB: file_type, drive_file_id (nëse ndryshon), web_view_link (nëse ndryshon), updated_at.
5) Backend kthen 200 me dokumentin e përditësuar.

________________________________________
8. Modeli i të dhënave (Database Schema)

8.1. Tabela kryesore: academic_documents
Nënseksion: Fusha (propozim)
- id (BIGINT, PK)
- title (TEXT, NOT NULL)
- description (TEXT, NULL)
- category (VARCHAR, NOT NULL) p.sh. request/decision/form/announcement
- tags (TEXT[] ose TEXT)
- file_type (VARCHAR(100), NOT NULL)
- drive_file_id (TEXT, UNIQUE, NOT NULL)
- web_view_link (TEXT, NOT NULL)
- status (VARCHAR(20), NOT NULL) p.sh. active/archived
- ai_summary (TEXT, NULL)
- created_at (TIMESTAMPTZ, DEFAULT NOW())
- updated_at (TIMESTAMPTZ, DEFAULT NOW())

Nënseksion: Rregulla integriteti
- drive_file_id unik.
- status vetëm nga lista e lejuar.

Nënseksion: Kriter pranimi
- Skema mbështet listim/kërkim/arkivim pa pasur nevojë të lexohet Drive.

________________________________________
9. Specifikimi i API (REST Endpoints)

9.1. Konventa
- Base path: /api
- Format përgjigjeje: JSON
- Upload: multipart/form-data
- Auth: Authorization: Bearer <token> (i detyrueshëm për çdo endpoint përveç login)
- Kodet e përgjigjes: 200/201/204, 400, 401, 403, 404, 409, 500

9.2. Endpoint-e kryesore (minimum i temës)
Nënseksion: Features/Funksione
- POST /api/auth/login
  - Qëllimi: autentikim dhe marrje token
  - Input JSON: { "username" ose "email", "password" }
  - Output 200: { "access_token": "...", "token_type": "bearer", "role": "..." }
- POST /api/documents
  - Qëllimi: Upload dokument + krijim metadata
  - Input: multipart: file, title, category, description?, tags?
  - Output 201: { id, title, category, file_type, drive_file_id, web_view_link, status, created_at, ai_summary? }
- GET /api/documents
  - Qëllimi: Listim/Kërkim
  - Query params: query?, category?, status? (active/archived), from?, to?
  - Output 200: [ ... ]
- GET /api/documents/{id}
  - Qëllimi: Detaje
  - Output 200: { ... }
- PUT /api/documents/{id}/file
  - Qëllimi: Replace file në Google Drive për dokument ekzistues
  - Input: multipart: file
  - Output 200: { ... (me web_view_link/file_type të përditësuar) }
- PUT /api/documents/{id}
  - Qëllimi: Përditësim metadata
  - Input JSON: { title, category, description, tags, status? }
  - Output 200: { ... }
- PATCH /api/documents/{id}/archive
  - Qëllimi: Arkivim
  - Output 200: { ... }
- DELETE /api/documents/{id}
  - Qëllimi: Hard delete (admin)
  - Output 204 ose 200 me mesazh

9.3. Shembuj kërkese/përgjigjeje (për raportin teknik)
Nënseksion: GET listim
- Kërkesë: GET /api/documents?query=vendim&category=decision&status=active
- Përgjigje 200 (shembull):
  [{"id":1,"title":"Vendim për ...","category":"decision","web_view_link":"https://...","status":"active","created_at":"..."}]

Nënseksion: Gabime tipike
- 400: mungon title ose file.
- 401/403: pa autentikim ose pa rol.
- 404: dokumenti nuk ekziston.
- 409: drive_file_id ekziston (nëse tenton duplikim).

________________________________________
10. Kërkesat jo-funksionale (Non-Functional Requirements)

10.1. Siguria
Nënseksion: Features/Funksione
- Kredencialet në .env (jo në kod).
- CORS i kufizuar për origjinat e lejuara.
- Validim i inputeve dhe kufi i madhësisë së skedarit.
- Endpoint-e të mbrojtura me autentikim dhe RBAC.

Nënseksion: Kriter pranimi
- Asnjë secret nuk gjendet në repo.
- Çdo kërkesë pa token merr 401 dhe çdo kërkesë jashtë rolit merr 403.

10.2. Performanca dhe besueshmëria
Nënseksion: Rregulla
- DB query për listim/kërkim (pa thirrur Drive).
- Transaksion logjik: nëse Drive upload dështon, anulon DB insert.

10.3. Logging dhe audit
Nënseksion: Features/Funksione
- Regjistrim i veprimeve kryesore: upload/update/archive/delete (minimum në log serveri).

________________________________________
11. Testim dhe demonstrim (si klient tjetër)

11.1. Skenarë testimi minimal
Nënseksion: Features/Funksione
- Upload një PDF dhe verifiko që linku hapet.
- Listim dhe kërkim me query.
- Update metadata (ndrysho titullin).
- Arkivim dhe shfaqje në listën “archived”.

11.2. Demonstrimi i komunikimit në rrjet
- Klienti React (ose Postman/Insomnia) demonstron thirrjet HTTP ndaj API.
- Swagger UI përdoret për verifikim të endpoint-eve.

________________________________________
12. Dorëzimi (përputhje me kërkesat e lëndës)

12.1. Çfarë dorëzohet
- Kodi burimor (GitHub/GitLab ose ZIP).
- Raport teknik (Word) që përfshin:
  - Përshkrimin e temës së zgjedhur.
  - Arkitekturën e sistemit.
  - Teknologjitë e përdorura.
  - Shembuj të kërkesave dhe përgjigjeve (REST) me screenshot/JSON.
  - (Nëse përdoret cloud hosting) linkun publik të shërbimit.
  - Udhëzime për testim dhe ekzekutim lokal.

12.2. Udhëzime ekzekutimi lokal (për PRD/raport)
Nënseksion: Kërkesa
- Konfiguro .env me:
  - kredencialet e Google Service Account
  - identifikuesit/çelësat e DB (Supabase)
- Start backend (FastAPI) dhe klientin (React).

Nënseksion: Kriter pranimi
- Një përdorues mund të testojë endpoint-et me Postman/Swagger dhe të shohë dokumentin në Drive.
